<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silver Market Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>Silver Market Intelligence</h1>
            <p class="subtitle">Real-time tracking of Futures, Inventory, Flows, and Macro Indicators</p>
        </header>

        <div class="grid">
            <!-- Futures Card -->
            <div class="card">
                <h2>COMEX Futures (Mar '26)</h2>
                <div class="metric-group">
                    <div class="metric">
                        <span class="label">Price</span>
                        <span class="value" id="futures-price">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">Volume</span>
                        <span class="value" id="futures-volume">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">Open Interest</span>
                        <span class="value" id="futures-oi">Loading...</span>
                    </div>
                </div>
                <div class="chart-container">
                    <div id="futuresChart" style="width: 100%; height: 100%;"></div>
                </div>
            </div>

            <!-- SLV Inventory Card -->
            <div class="card">
                <h2>iShares Silver Trust (SLV)</h2>
                <div class="metric-group">
                    <div class="metric">
                        <span class="label">Inventory (Tonnes)</span>
                        <span class="value" id="slv-tonnes">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">Inventory (oz)</span>
                        <span class="value" id="slv-ounces">Loading...</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="slvChart"></canvas>
                </div>
            </div>

            <!-- Exchange Stocks Card -->
            <div class="card">
                <h2>Exchange Inventories</h2>
                <div class="metric-group">
                    <div class="metric">
                        <span class="label">CME Registered</span>
                        <span class="value" id="cme-registered">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">CME Eligible</span>
                        <span class="value" id="cme-eligible">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">LBMA Holdings</span>
                        <span class="value" id="lbma-holdings">Loading...</span>
                    </div>
                </div>
                <div class="chart-container">
                    <div id="inventoryChart" style="width: 100%; height: 100%;"></div>
                </div>
            </div>

            <!-- New Cards for v2 -->
            
            <!-- Macro Card -->
            <div class="card">
                <h2>Macro Indicators (P2)</h2>
                <div class="metric-group">
                    <div class="metric">
                        <span class="label">USD Index (DXY)</span>
                        <span class="value" id="macro-dxy">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">US 10Y Real Yield</span>
                        <span class="value" id="macro-yield">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">Gold/Silver Ratio</span>
                        <span class="value" id="macro-gsr">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">USD/CNY</span>
                        <span class="value" id="macro-cny">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Sentiment Card -->
            <div class="card">
                <h2>Sentiment & Flows (P1)</h2>
                <div class="metric-group">
                    <div class="metric">
                        <span class="label">SLV Put/Call Ratio</span>
                        <span class="value" id="sent-pc-ratio">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">Call Volume</span>
                        <span class="value" id="sent-call-vol">Loading...</span>
                    </div>
                    <div class="metric">
                        <span class="label">COT Status</span>
                        <span class="value" id="sent-cot">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- P0 Indicators Card -->
            <div class="card card-wide">
                <h2>ðŸŽ¯ P0 Indicators (Squeeze Signals)</h2>
                <div class="metric-grid">
                    <div class="metric-box">
                        <span class="label">Paper/Physical Ratio</span>
                        <span class="value highlight" id="p0-paper-physical">Loading...</span>
                        <span class="sublabel">COMEX OI / Registered</span>
                    </div>
                    <div class="metric-box">
                        <span class="label">SLV Coverage</span>
                        <span class="value" id="p0-slv-coverage">Loading...</span>
                        <span class="sublabel">Registered / SLV oz</span>
                    </div>
                    <div class="metric-box">
                        <span class="label">COMEX Dominance</span>
                        <span class="value" id="p0-dominance">Loading...</span>
                        <span class="sublabel">OI / SLV Ratio</span>
                    </div>
                    <div class="metric-box">
                        <span class="label">Shanghai Premium</span>
                        <span class="value highlight" id="p0-shanghai-prem">Loading...</span>
                        <span class="sublabel">USD/oz vs COMEX</span>
                    </div>
                    <div class="metric-box">
                        <span class="label">SHFE Turnover</span>
                        <span class="value" id="p0-shfe-turnover">Loading...</span>
                        <span class="sublabel">Vol / OI</span>
                    </div>
                    <div class="metric-box">
                        <span class="label">SHFE Concentration</span>
                        <span class="value" id="p0-shfe-conc">Loading...</span>
                        <span class="sublabel">Main / Total OI</span>
                    </div>
                    <div class="metric-box">
                        <span class="label">SHFE Curve Slope</span>
                        <span class="value" id="p0-curve-slope">Loading...</span>
                        <span class="sublabel">Far - Near (CNY)</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="p0Chart"></canvas>
                </div>
            </div>

            <!-- P0 Trends Card -->
            <div class="card card-wide">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="margin: 0;">ðŸ“ˆ P0 Indicator Trends</h2>
                    <select id="p0-metric-select" style="background: #1e293b; color: #e2e8f0; border: 1px solid #334155; padding: 0.5rem; border-radius: 0.25rem;">
                        <option value="Paper_to_Physical">Paper/Physical Ratio</option>
                        <option value="Shanghai_Premium_Implied">Shanghai Premium</option>
                        <option value="SLV_Coverage">SLV Coverage</option>
                        <option value="COMEX_Dominance">COMEX Dominance</option>
                        <option value="Turnover_ag2603">SHFE Turnover</option>
                        <option value="OI_concentration_2603">SHFE Concentration</option>
                        <option value="Curve_slope_SHFE_3m6m">SHFE Curve Slope</option>
                        <option value="COMEX_Silver_Registered">COMEX Registered</option>
                        <option value="COMEX_IssuesStops_Silver">COMEX Issues/Stops</option>
                    </select>
                </div>
                <div class="chart-container">
                    <div id="p0HistoryChart" style="width: 100%; height: 100%;"></div>
                </div>
            </div>

            <!-- Shanghai Premium Card -->
            <div class="card">
                <h2>Shanghai Premium (P0)</h2>
                <div class="metric-group">
                    <div class="metric">
                        <span class="label">SHFE Price (CNY)</span>
                        <span class="value" id="shfe-price">N/A</span>
                    </div>
                    <div class="metric">
                        <span class="label">Premium (USD/oz)</span>
                        <span class="value" id="shfe-premium">N/A</span>
                    </div>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-secondary);">* SHFE data access currently restricted</p>
            </div>

        </div>
        
        <footer>
            <p>Data Sources: CME Group, iShares, LBMA, Yahoo Finance, FRED, CFTC. <br> Note: Some data may be delayed or estimated.</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
